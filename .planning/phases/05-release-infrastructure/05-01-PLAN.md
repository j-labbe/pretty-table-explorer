---
phase: 05-release-infrastructure
plan: 01
type: execute
depends_on: []
files_modified: [Cargo.toml, src/main.rs]
---

<objective>
Add version embedding and --version flag to the binary.

Purpose: Enable users to check installed version, required for self-update feature in Phase 6.
Output: Binary that responds to `pte --version` with version from Cargo.toml.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@Cargo.toml
@src/main.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add clap dependency and CLI argument parsing</name>
  <files>Cargo.toml, src/main.rs</files>
  <action>
1. Add clap to Cargo.toml with derive feature: `clap = { version = "4", features = ["derive"] }`
2. In main.rs, create a CLI struct with clap derive:
   - Add `--version` via clap's built-in version handling (use #[command(version)])
   - Keep existing `--connect` flag functionality
   - Clap will automatically handle `-V` and `--version` flags
3. Replace manual argument parsing in main() with clap's Args::parse()
4. Ensure existing --connect behavior is preserved

The clap crate automatically reads version from Cargo.toml via env!("CARGO_PKG_VERSION").
Do NOT add custom version handling - let clap do it.
  </action>
  <verify>cargo build --release && ./target/release/pte --version</verify>
  <done>pte --version outputs "pte 0.1.0" (or current version), pte --connect still works</done>
</task>

<task type="auto">
  <name>Task 2: Update Cargo.toml metadata for release</name>
  <files>Cargo.toml</files>
  <action>
1. Add package metadata to Cargo.toml:
   - description = "Interactive terminal table viewer for PostgreSQL"
   - authors = ["Your Name"]
   - license = "MIT"
   - repository = "https://github.com/yourusername/pretty-table-explorer"
   - homepage (optional, same as repository)
   - readme = "README.md"
2. Bump version to 1.0.0 to match shipped milestone

Leave repository/authors as placeholders if unknown - they can be updated later.
  </action>
  <verify>cargo metadata --format-version 1 | jq '.packages[] | select(.name == "pretty-table-explorer") | {version, description}'</verify>
  <done>Cargo metadata shows version 1.0.0 and description, clap picks up new version</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build --release` succeeds
- [ ] `./target/release/pte --version` outputs version
- [ ] `./target/release/pte -V` outputs version (short form)
- [ ] `./target/release/pte --help` shows usage with version
- [ ] `./target/release/pte --connect "..."` still works (existing functionality)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No regressions to existing --connect functionality
- Version output matches Cargo.toml version
</success_criteria>

<output>
After completion, create `.planning/phases/05-release-infrastructure/05-01-SUMMARY.md`
</output>
