---
phase: 02-table-rendering
plan: 02
type: execute
depends_on: ["02-01"]
files_modified: [src/main.rs]
---

<objective>
Render parsed table data using ratatui's Table widget with calculated column widths.

Purpose: Display clean, aligned table output that replaces the placeholder UI.
Output: Working table display from piped psql data with proper column alignment.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-table-rendering/02-01-SUMMARY.md
@src/main.rs
@src/parser.rs

**ratatui Table API (v0.29):**
```rust
use ratatui::widgets::{Table, Row, Cell};

// Create rows from data
let rows: Vec<Row> = data.iter()
    .map(|row| Row::new(row.iter().map(|s| Cell::from(s.as_str()))))
    .collect();

// Create table with column widths
let table = Table::new(rows, widths)
    .header(header_row)
    .block(Block::default().borders(Borders::ALL));

// Render
frame.render_widget(table, area);
```

**Column width calculation:**
- For each column, find max width across header + all data rows
- Use `Constraint::Length(max_width)` for each column
</context>

<tasks>

<task type="auto">
  <name>Task 1: Calculate column widths from TableData</name>
  <files>src/main.rs</files>
  <action>Add function to calculate column widths:

```rust
fn calculate_widths(data: &parser::TableData) -> Vec<Constraint> {
    let num_cols = data.headers.len();
    let mut widths = vec![0usize; num_cols];

    // Check header widths
    for (i, header) in data.headers.iter().enumerate() {
        widths[i] = widths[i].max(header.len());
    }

    // Check data row widths
    for row in &data.rows {
        for (i, cell) in row.iter().enumerate() {
            if i < num_cols {
                widths[i] = widths[i].max(cell.len());
            }
        }
    }

    // Convert to Constraints (add 1 for padding)
    widths.iter().map(|w| Constraint::Length((*w + 1) as u16)).collect()
}
```

This handles variable-length data and ensures columns fit their content.</action>
  <verify>Print calculated widths for test data to verify they match expected max lengths</verify>
  <done>calculate_widths function exists and returns appropriate Constraint vector</done>
</task>

<task type="auto">
  <name>Task 2: Render Table widget with parsed data</name>
  <files>src/main.rs</files>
  <action>Replace placeholder UI with Table widget:

1. Add imports: `use ratatui::widgets::{Table, Row, Cell};`

2. In the draw closure, replace the centered block with:
   - Create header Row from TableData.headers with distinct style
   - Create data Rows from TableData.rows
   - Build Table with calculated widths
   - Wrap in Block with title and borders
   - Render to full area (no centering needed)

3. Style the table:
   - Header: bold or different color to distinguish
   - Data rows: default style
   - Block: title " Pretty Table Explorer " with borders

4. Remove the old centered layout and placeholder paragraph code.

The table should fill the terminal area. Navigation/scrolling comes in Phase 3.</action>
  <verify>`echo -e " id | name | value\n----+------+------\n 1  | foo  | 100\n 2  | bar  | 200\n(2 rows)" | cargo run` displays a clean table with aligned columns</verify>
  <done>Table widget renders with proper column alignment, header is visually distinct, borders display correctly</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build` succeeds without errors
- [ ] Table renders with correct column alignment
- [ ] Header row is visually distinct from data rows
- [ ] Long column values don't break alignment
- [ ] Works with various psql outputs (3+ columns, 10+ rows)
</verification>

<success_criteria>

- Table widget replaces placeholder UI
- Columns are properly aligned based on content width
- Header row styled distinctly from data
- Clean display with borders and title
- Phase 2 complete - ready for Phase 3 (Navigation)
</success_criteria>

<output>
After completion, create `.planning/phases/02-table-rendering/02-02-SUMMARY.md`
</output>
