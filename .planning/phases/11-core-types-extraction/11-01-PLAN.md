---
phase: 11-core-types-extraction
plan: 01
type: execute
depends_on: []
files_modified: [src/state.rs, src/main.rs]
---

<objective>
Extract application state types (AppMode, PendingAction, PaneRenderData) from main.rs into a dedicated state module.

Purpose: Reduce main.rs complexity and establish clear module boundaries for state management types.
Output: New src/state.rs module containing core application state types, main.rs updated to import from state module.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/main.rs
@src/workspace.rs

**Current Structure:**
main.rs contains 1,566 lines with types, rendering, CLI parsing, and event loop all intermingled.

**Types to Extract:**
1. `AppMode` enum (lines 51-57) - Application input modes (Normal, QueryInput, SearchInput, ExportFormat, ExportFilename)
2. `PendingAction` enum (lines 60-65) - Deferred actions to avoid borrow conflicts
3. `PaneRenderData` struct (lines 68-95) - Pre-computed render state for table panes

**Dependencies:**
- PaneRenderData uses ratatui::prelude::Constraint (for widths field)
- PendingAction uses parser::TableData and workspace::ViewMode

**Pattern Reference:**
workspace.rs demonstrates the existing module pattern: imports at top, struct/enum definitions, impl blocks, tests at bottom.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create state.rs module with extracted types</name>
  <files>src/state.rs</files>
  <action>
Create new src/state.rs with:

1. Module doc comment explaining purpose (application state types)

2. Required imports:
   - `ratatui::prelude::Constraint` for PaneRenderData.widths
   - `crate::parser::TableData` for PendingAction::CreateTab
   - `crate::workspace::ViewMode` for PendingAction::CreateTab

3. AppMode enum:
   - Copy from main.rs lines 51-57
   - Add `#[derive(Clone, Copy, PartialEq)]`
   - Make it `pub` for use in main.rs

4. PendingAction enum:
   - Copy from main.rs lines 60-65
   - Make it `pub` for use in main.rs
   - Note: Contains TableData and ViewMode in CreateTab variant

5. PaneRenderData struct:
   - Copy from main.rs lines 68-95
   - Make struct and all fields `pub` for use in main.rs
   - Preserves all field comments

Do NOT copy doc comments that reference line numbers - those are for this plan only.
  </action>
  <verify>File exists at src/state.rs with AppMode, PendingAction, and PaneRenderData defined</verify>
  <done>src/state.rs created with all three types properly defined with correct visibility and imports</done>
</task>

<task type="auto">
  <name>Task 2: Update main.rs to use state module</name>
  <files>src/main.rs</files>
  <action>
1. Add `mod state;` to the module declarations at the top of main.rs (after line 6, with other mod declarations)

2. Add imports from state module after the other use statements:
   `use state::{AppMode, PendingAction, PaneRenderData};`

3. Remove the following from main.rs:
   - AppMode enum definition (lines 49-57, including doc comment on line 49)
   - Empty line after AppMode (line 58 if exists)
   - PendingAction enum definition (lines 60-65, including doc comment)
   - Empty line after PendingAction (if exists)
   - PaneRenderData struct definition (lines 67-95, including doc comment)

The remaining main.rs should have no local definitions of these types - they're imported from state module.

Do NOT change any function signatures or implementations that use these types.
  </action>
  <verify>cargo check passes with no errors</verify>
  <done>main.rs imports AppMode, PendingAction, PaneRenderData from state module; no duplicate definitions remain</done>
</task>

<task type="auto">
  <name>Task 3: Verify build and run tests</name>
  <files>src/state.rs, src/main.rs</files>
  <action>
1. Run `cargo build` to verify the full build succeeds
2. Run `cargo test` to ensure no tests are broken
3. Run `cargo clippy` to check for any new warnings

If any issues arise:
- Check that all imports are correct in state.rs
- Verify visibility modifiers (pub) are on all types that need to be accessed from main.rs
- Ensure no circular dependencies exist
  </action>
  <verify>cargo build succeeds, cargo test passes, cargo clippy shows no new warnings</verify>
  <done>Build succeeds, all tests pass, no clippy warnings introduced</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cargo build` succeeds without errors
- [ ] `cargo test` passes all tests
- [ ] `cargo clippy` shows no new warnings
- [ ] main.rs no longer contains AppMode, PendingAction, or PaneRenderData definitions
- [ ] src/state.rs exists with all three types properly defined
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- main.rs reduced by ~50 lines (types moved to state.rs)
- Clean module boundary established for application state types
</success_criteria>

<output>
After completion, create `.planning/phases/11-core-types-extraction/11-01-SUMMARY.md`:

# Phase 11 Plan 01: State Module Extraction Summary

**[Substantive one-liner describing what shipped]**

## Accomplishments

- Created src/state.rs module with application state types
- Extracted AppMode, PendingAction, PaneRenderData from main.rs
- Updated main.rs imports to use new module

## Files Created/Modified

- `src/state.rs` - New module containing application state types
- `src/main.rs` - Removed type definitions, added state module import

## Decisions Made

[Any decisions about type organization or visibility]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for Phase 11 Plan 02 (if more plans) or Phase 12
</output>
