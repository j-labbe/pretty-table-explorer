---
phase: 10-scroll-indicators
plan: 01-FIX
type: fix
---

<objective>
Fix 3 UAT issues from plan 10-01.

Source: 10-01-ISSUES.md
Priority: 0 critical, 3 major, 0 minor
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/10-scroll-indicators/10-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/10-scroll-indicators/10-01-PLAN.md

**Key source file:**
@src/main.rs (lines 217-388, render_table_pane function)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix scroll indicator positioning and data overlap</name>
  <files>src/main.rs</files>
  <action>
Debug and fix the scroll indicator column rendering in `render_table_pane()`.

**Problem analysis:**
The current implementation adds indicator columns to header_cells, data_rows, and render_widths when `has_left_overflow` or `has_right_overflow` is true. However, the indicators are overlapping data instead of appearing in their own column.

**Likely root cause:**
The width calculation reserves space for indicators (`width_minus_left` and `width_with_right_reserved`), but the actual column fitting loop may not be accounting for this correctly. The cumulative_width calculation adds `col_width + 1` (for separator), but the available width comparison may be off.

**Fix approach:**
1. Add debug logging temporarily to understand what's happening
2. Check that available_width calculation properly accounts for:
   - 2 chars for borders
   - 3 chars for ">> " highlight symbol
   - 1 char for left indicator (if has_left_overflow)
   - 1 char for right indicator (reserved in first pass)
3. Ensure render_widths matches what's actually being rendered
4. Verify the total width of all constraints doesn't exceed available area

**Specific checks:**
- Verify `Constraint::Length(1)` for indicators is being added at the right position
- Verify the columns that fit calculation uses the correct available width
- Check if ratatui's Table widget is laying out columns correctly given the constraints

**Test manually:**
1. Load a table with many columns
2. Don't scroll - verify no indicators appear
3. Scroll right - verify left indicator appears in its OWN column (not overlapping)
4. Continue scrolling - verify right indicator appears in its OWN column when overflow exists
5. Scroll to middle - verify both indicators appear correctly
  </action>
  <verify>cargo build --release passes. Visual inspection shows indicators in their own dedicated 1-char columns, not overlapping any data.</verify>
  <done>Left and right scroll indicators render in their own columns without overlapping table data.</done>
</task>

<task type="auto">
  <name>Task 2: Fix column selection offset calculation</name>
  <files>src/main.rs</files>
  <action>
Fix the `render_col_position` calculation in `render_table_pane()`.

**Current code (lines 295-306):**
```rust
let data_col_position = pane.selected_visible_col.saturating_sub(pane.scroll_col_offset);
let data_col_position = data_col_position.min(render_cols.len().saturating_sub(1));
let render_col_position = if has_left_overflow {
    data_col_position + 1 // Skip the left indicator column
} else {
    data_col_position
};
```

**Problem:**
The column selection is offset incorrectly when indicators are visible. The selection doesn't land on the expected data column.

**Fix approach:**
1. Review how ratatui's `table_state.select_column()` interprets the column index
2. The render_col_position should be the index into the RENDERED cells array (including indicator cells)
3. If left indicator is present:
   - Index 0 = left indicator
   - Index 1 = first data column
   - So data_col_position 0 should map to render_col_position 1
4. The current logic seems correct, so the issue may be elsewhere:
   - Check if data_col_position calculation is correct
   - Check if render_cols is built correctly

**Additional considerations:**
- The right indicator column should NEVER be selected
- If render_col_position equals or exceeds the number of rendered columns, clamp it

**Verify fix:**
1. With left indicator visible, select first data column - highlight should be on first DATA column
2. Navigate through columns - highlight should track correctly
3. With right indicator visible, select last data column - highlight should be on last DATA column, not indicator
  </action>
  <verify>cargo build --release passes. Column selection correctly highlights the intended data column when indicators are present.</verify>
  <done>Column selection stays on data columns and never highlights indicator columns. Selection position is correct regardless of which indicators are visible.</done>
</task>

<task type="auto">
  <name>Task 3: Run tests and verify all scenarios</name>
  <files>src/main.rs</files>
  <action>
Run full test suite and manually verify all scroll indicator scenarios work correctly.

**Automated tests:**
- Run `cargo test` - all existing tests should pass
- The tests validate navigation, column visibility, and scrolling logic

**Manual verification scenarios:**
1. **No overflow:** Load table that fits entirely - no indicators should appear
2. **Left only:** Start at right edge of wide table - only left indicator
3. **Right only:** Start at left edge of wide table - only right indicator
4. **Both:** Scroll to middle of wide table - both indicators visible
5. **Column selection with left indicator:** Navigate columns, verify correct highlighting
6. **Column selection with right indicator:** Navigate columns, verify correct highlighting
7. **Column selection with both indicators:** Navigate columns, verify correct highlighting
8. **Edge case:** Single column visible - indicators should work correctly

**If any test fails:**
- Debug the specific scenario
- Fix the root cause
- Re-run all tests
  </action>
  <verify>cargo test passes all tests. All 8 manual scenarios work correctly.</verify>
  <done>All tests pass and all scroll indicator scenarios work as expected.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All critical issues fixed
- [ ] All major issues fixed
- [ ] Minor issues fixed or documented as deferred
- [ ] Original acceptance criteria from issues met
- [ ] `cargo build --release` succeeds
- [ ] `cargo test` passes
</verification>

<success_criteria>
- All UAT issues from 10-01-ISSUES.md addressed
- Tests pass
- Ready for re-verification with /gsd:verify-work 10-01
</success_criteria>

<output>
After completion, create `.planning/phases/10-scroll-indicators/10-01-FIX-SUMMARY.md`
</output>
