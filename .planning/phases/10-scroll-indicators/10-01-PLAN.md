---
phase: 10-scroll-indicators
plan: 01
type: execute
depends_on: []
files_modified: [src/main.rs]
---

<objective>
Add visual arrow columns on table edges indicating horizontal scroll availability.

Purpose: Provide persistent, visible scroll indicators within the table area itself (not just title bar) so users always know when more content exists off-screen.
Output: Arrow columns rendered on left/right table edges when scrollable content exists in that direction.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior summaries (relevant to rendering):
@.planning/phases/07-column-controls/07-04-SUMMARY.md

# Key source files:
@src/main.rs

**Tech stack available:** ratatui v0.29, crossterm v0.28
**Established patterns:** PaneRenderData for render state, render_table_pane() helper, horizontal scroll viewport calculation

**Current state:**
- Overflow indicators exist in title bar (◀ ▶) via `has_left_overflow` and `has_right_overflow` booleans
- Horizontal scrolling works with `scroll_col_offset` tracking first visible column
- `render_table_pane()` calculates visible column range based on available width
- Table uses ratatui's Table widget with Block borders

**Phase 10 goal:**
Render arrow columns (not just title text) on the actual table edges when overflow exists. These should be thin dedicated columns showing "◀" or "▶" (or similar arrows) that indicate scrollability, positioned at the edge of the table content area.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add left scroll indicator column to render_table_pane</name>
  <files>src/main.rs</files>
  <action>
In `render_table_pane()`:

1. After calculating `has_left_overflow` and `has_right_overflow`, create indicator column data:
   - If `has_left_overflow`: Add a 1-char wide "indicator" column at the start of header_cells and each data row
   - Header cell: " " (space) styled with dark gray background
   - Data cells: "◀" (or "←") styled with dark gray background and dim foreground
   - Width constraint: `Constraint::Length(1)`

2. Modify the header_cells construction:
   - If `has_left_overflow`: prepend the indicator cell before the mapped header cells
   - Use `std::iter::once()` to prepend the single cell

3. Modify the data_rows construction:
   - If `has_left_overflow`: prepend the indicator cell "◀" to each row
   - Style: `Style::default().bg(Color::DarkGray).fg(Color::Gray)`

4. Modify render_widths:
   - If `has_left_overflow`: prepend `Constraint::Length(1)` to the widths vector

5. Adjust `available_width` calculation to account for indicator columns:
   - Subtract 1 if `has_left_overflow` expected (need to pre-calculate or do two-pass)
   - Better approach: After initial calculation, if left indicator will be added, recalculate render_cols with reduced width

Note: The left indicator is simpler because we know `has_left_overflow` from `scroll_col_offset > 0` before calculating visible columns.
  </action>
  <verify>cargo build --release passes. When viewing a wide table and scrolling right (so left overflow exists), a thin column with "◀" appears on the left edge of the table.</verify>
  <done>Left scroll indicator column renders when `has_left_overflow` is true, styled distinctly from data columns.</done>
</task>

<task type="auto">
  <name>Task 2: Add right scroll indicator column to render_table_pane</name>
  <files>src/main.rs</files>
  <action>
In `render_table_pane()`:

1. The right indicator requires knowing `has_right_overflow` BEFORE deciding what to render:
   - Current approach: Calculate visible columns, then check if more remain
   - New approach: Reserve 1 char for right indicator when calculating available_width, then add it if needed

2. Modify available_width calculation:
   - `let available_width = area.width.saturating_sub(2 + 3 + 2);` // +2 reserved for potential indicators
   - Or calculate in two passes: first determine if overflow exists, then re-calculate with correct width

3. If `has_right_overflow`:
   - Append a 1-char wide indicator column after the data columns
   - Header cell: " " (space) with dark gray background
   - Data cells: "▶" (or "→") styled with `Style::default().bg(Color::DarkGray).fg(Color::Gray)`
   - Append `Constraint::Length(1)` to render_widths

4. Update `header_cells` and `data_rows` to append the right indicator when needed.

5. Verify the table_state column selection still works correctly:
   - The indicator columns are not selectable
   - The `render_col_position` should not include indicator columns in its count
  </action>
  <verify>cargo build --release passes. When viewing a table with columns extending past the right edge, a thin column with "▶" appears on the right edge.</verify>
  <done>Right scroll indicator column renders when `has_right_overflow` is true. Both indicators can appear simultaneously when scrolled to the middle of a wide table.</done>
</task>

<task type="auto">
  <name>Task 3: Ensure indicator columns don't interfere with navigation</name>
  <files>src/main.rs</files>
  <action>
Verify and fix any interaction issues:

1. Column highlight: Indicator columns should NOT be highlighted when navigating.
   - The `table_state.select_column(Some(render_col_position))` must map to data columns only
   - If indicator columns are prepended/appended, adjust render_col_position to account for them
   - Example: if left indicator present, actual column 0 is at render position 1

2. Test scenarios:
   - Navigate to first visible column with left indicator present: highlight should be on first DATA column, not indicator
   - Navigate to last visible column with right indicator present: highlight should be on last DATA column, not indicator

3. Adjust render_col_position calculation:
   - `let adjusted_col_position = render_col_position + (if has_left_overflow { 1 } else { 0 });`
   - Pass this adjusted position to table_state.select_column()

4. Run all existing tests to ensure no regressions.
  </action>
  <verify>`cargo test` passes all 32+ existing tests. Column navigation works correctly when indicators are present - selection stays on data columns.</verify>
  <done>Column navigation ignores indicator columns. Selection highlight stays on data columns. All existing tests pass.</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cargo build --release` succeeds without errors or warnings
- [ ] `cargo test` passes all tests
- [ ] Left indicator (◀) appears when scrolled right in a wide table
- [ ] Right indicator (▶) appears when columns extend beyond viewport
- [ ] Both indicators appear when in middle of a very wide table
- [ ] Column selection highlight stays on data columns, not indicators
- [ ] Indicators do not appear when all columns fit in viewport
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript/Rust errors
- Visual scroll indicators render on table edges
- Existing functionality (navigation, column controls, split view) unaffected
- Phase 10 complete, v1.2 milestone complete
</success_criteria>

<output>
After completion, create `.planning/phases/10-scroll-indicators/10-01-SUMMARY.md`:

# Phase 10: Scroll Indicators (Plan 01) Summary

**[Substantive one-liner describing what shipped]**

## Performance

- **Duration:** X min
- **Started:** YYYY-MM-DDTHH:MM:SSZ
- **Completed:** YYYY-MM-DDTHH:MM:SSZ

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Task Commits

1. **Task 1:** [commit hash] (type)
2. **Task 2:** [commit hash] (type)
3. **Task 3:** [commit hash] (type)

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 10 complete, v1.2 Advanced Viewing milestone complete.
</output>
