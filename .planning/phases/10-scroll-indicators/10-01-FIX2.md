---
phase: 10-scroll-indicators
plan: 10-01-FIX2
type: fix
---

<objective>
Fix 1 UAT issue from plan 10-01.

Source: 10-01-ISSUES.md
Priority: 0 critical, 1 major, 0 minor

UAT-004: Right indicator not fixed to viewport edge with wide columns â€” the indicator should always be at the rightmost edge of the viewport, and wide columns should show partial content instead of being hidden.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/10-scroll-indicators/10-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/10-scroll-indicators/10-01-PLAN.md

**Key source files:**
@src/main.rs

**Root cause analysis:**
The `render_table_pane()` function currently:
1. Calculates which columns FULLY fit in the viewport
2. Stops adding columns when a column is too wide to fit
3. Renders the right indicator immediately after the last added column

This causes two problems:
1. Wide columns that don't fit are completely hidden (blank area appears)
2. The right indicator is positioned after the last visible column, not at the viewport edge

**Fix approach:**
1. Fill remaining viewport space with partial column content when a column is too wide
2. Truncate wide column content to fit available space
3. Always position right indicator at viewport edge (if overflow exists)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Show partial content for wide columns that don't fully fit</name>
  <files>src/main.rs</files>
  <action>
In `render_table_pane()`, modify the column-fitting logic:

1. After the column-fitting loop completes, check if there's remaining viewport space AND more columns exist:
   - Calculate `remaining_space = available_width - cumulative_width`
   - If `remaining_space > 0` and there are more columns after `last_render_idx`:
     - Get the next column that would have been added
     - Add it to `render_cols` with a TRUNCATED width (use remaining_space instead of full width)
     - Track that this column is truncated so we can set the correct Constraint

2. Modify the render_widths construction to handle the truncated column:
   - For the last column, if it was truncated, use `Constraint::Length(remaining_space)` instead of the full width
   - Or store a `truncated_width: Option<u16>` and apply it to the last column

3. The column content will naturally be truncated by ratatui when the cell is narrower than the content.

This ensures:
- No blank space appears in the table
- Wide columns show as much content as fits
- Users can scroll right to see the rest of the wide column
  </action>
  <verify>cargo build --release passes. When a column is too wide to fit completely, it shows partial content (truncated) filling the viewport space instead of being hidden.</verify>
  <done>Wide columns that don't fully fit show partial content in the available space. No blank areas in the table viewport.</done>
</task>

<task type="auto">
  <name>Task 2: Fix right indicator to viewport edge</name>
  <files>src/main.rs</files>
  <action>
The current implementation places the right indicator column after the last data column's width. When columns don't fill the viewport, there's a gap.

Fix approach - use ratatui's layout to ensure indicator is at edge:

1. When `has_right_overflow` is true, the right indicator should ALWAYS be at the rightmost position.

2. The key insight: ratatui Table with explicit Constraint::Length values will place columns left-to-right. If the sum of column widths doesn't fill the area, there's trailing space.

3. To fix the right indicator at the edge, we need to ensure the total width of all columns (including indicators) equals the available table width.

4. Adjust the last data column width to fill available space:
   - Calculate `total_used_width = sum of all render_widths`
   - `target_width = available table content width` (area.width - borders - highlight symbol)
   - `gap = target_width - total_used_width`
   - If `gap > 0` and there's at least one data column:
     - Expand the last data column's width by `gap`
     - This pushes the right indicator to the edge

5. Alternative (cleaner): Use Constraint::Fill(1) for the last data column instead of fixed Length. This will expand to fill available space, naturally pushing the right indicator to the edge.

   Change the render_widths construction:
   - For the LAST data column (before right indicator), use `Constraint::Fill(1)` instead of `Constraint::Length(w)`
   - This tells ratatui to expand this column to fill remaining space
  </action>
  <verify>cargo build --release passes. When right indicator is present, it always appears at the rightmost edge of the viewport, regardless of whether columns fill the space.</verify>
  <done>Right indicator is fixed to the viewport's right edge. No gap between last column and indicator.</done>
</task>

<task type="auto">
  <name>Task 3: Verify all scenarios work correctly</name>
  <files>src/main.rs</files>
  <action>
Test and verify the fixes work for all edge cases:

1. **Single wide column**: A column wider than the viewport should:
   - Show truncated content filling the viewport
   - Show right indicator at edge if more columns exist
   - Allow scrolling to see the rest (next scroll shows continuation)

2. **Multiple narrow columns**: Should work as before, with right indicator at edge.

3. **Mix of widths**: Narrow columns followed by a wide one should show the wide one truncated.

4. **No overflow**: When all columns fit, no indicators should appear and layout should be normal.

5. **Both indicators**: When scrolled to middle of wide table, both indicators should appear, right one at edge.

Run `cargo test` to ensure no regressions. Fix any issues discovered.
  </action>
  <verify>`cargo test` passes all tests. Manual verification of edge cases shows correct behavior.</verify>
  <done>All edge cases work correctly. Tests pass. No regressions in existing functionality.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All major issues fixed
- [ ] Tests pass
- [ ] Right indicator always at viewport edge when present
- [ ] Wide columns show partial content instead of being hidden
- [ ] No blank areas in table viewport
- [ ] Ready for re-verification with /gsd:verify-work 10-01
</verification>

<success_criteria>
- UAT-004 from 10-01-ISSUES.md addressed
- Tests pass
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/10-scroll-indicators/10-01-FIX2-SUMMARY.md`
</output>
