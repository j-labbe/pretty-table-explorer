---
phase: 07-column-controls
plan: 02
type: execute
depends_on: ["07-01"]
files_modified: [src/column.rs, src/main.rs]
---

<objective>
Add column hide/show functionality to toggle column visibility.

Purpose: Allow users to hide columns they don't need to see, reducing visual clutter for wide tables.
Output: H key hides selected column, S key shows all hidden columns, rendering skips hidden columns.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-column-controls/07-01-SUMMARY.md
@src/column.rs
@src/main.rs

**From Plan 01:**
- ColumnConfig with visibility tracking exists
- is_visible() method available
- calculate_widths() takes ColumnConfig parameter
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add visibility toggle methods to ColumnConfig</name>
  <files>src/column.rs</files>
  <action>
  Add methods to ColumnConfig:

  ```rust
  /// Hide a column
  pub fn hide(&mut self, col: usize) {
      if col < self.columns.len() {
          self.columns[col].visible = false;
      }
  }

  /// Show all hidden columns
  pub fn show_all(&mut self) {
      for col in &mut self.columns {
          col.visible = true;
      }
  }

  /// Count visible columns
  pub fn visible_count(&self) -> usize {
      self.columns.iter().filter(|c| c.visible).count()
  }

  /// Get visible column indices in order
  pub fn visible_indices(&self) -> Vec<usize> {
      self.columns
          .iter()
          .enumerate()
          .filter(|(_, c)| c.visible)
          .map(|(i, _)| i)
          .collect()
  }
  ```

  Also update reset() to show all columns (set visible = true for all).
  </action>
  <verify>cargo check passes</verify>
  <done>ColumnConfig has hide, show_all, visible_count, visible_indices methods</done>
</task>

<task type="auto">
  <name>Task 2: Update rendering to skip hidden columns</name>
  <files>src/main.rs</files>
  <action>
  Modify the table rendering inside terminal.draw() closure to filter by visibility.

  1. Before creating header_cells, get visible indices:
     ```rust
     let visible_cols = column_config.visible_indices();
     ```

  2. Create header row using only visible columns:
     ```rust
     let header_cells = visible_cols.iter().map(|&i| {
         Cell::from(table_data.headers[i].as_str())
             .style(Style::default().add_modifier(Modifier::BOLD))
     });
     ```

  3. Create data rows using only visible columns:
     ```rust
     let data_rows = display_rows.iter().map(|row| {
         let cells = visible_cols.iter().map(|&i| {
             Cell::from(row.get(i).map(|s| s.as_str()).unwrap_or(""))
         });
         Row::new(cells)
     });
     ```

  4. Update widths calculation to only include visible columns:
     ```rust
     let visible_widths: Vec<Constraint> = visible_cols
         .iter()
         .map(|&i| widths[i].clone())
         .collect();
     ```

  5. Use visible_widths in Table::new():
     ```rust
     let table = Table::new(data_rows, visible_widths)
     ```

  6. Update col_info in title to show "Col X/Y (Z hidden)" when columns are hidden:
     ```rust
     let hidden_count = table_data.headers.len() - column_config.visible_count();
     let hidden_info = if hidden_count > 0 {
         format!(" ({} hidden)", hidden_count)
     } else {
         String::new()
     };
     let col_info = table_state
         .selected_column()
         .map(|c| format!(" Col {}/{}{}", c + 1, column_config.visible_count(), hidden_info))
         .unwrap_or_default();
     ```

  Note: The column_config needs to be cloned or accessed before the closure since it's mutably borrowed for table_state. Create `let visible_cols = column_config.visible_indices();` before the draw closure.
  </action>
  <verify>cargo build --release succeeds</verify>
  <done>Hidden columns not rendered, column count in title reflects visible count</done>
</task>

<task type="auto">
  <name>Task 3: Add hide/show keybindings</name>
  <files>src/main.rs</files>
  <action>
  Add keybindings in AppMode::Normal match block (near other column controls):

  ```rust
  // Hide selected column (H key, uppercase to avoid conflict with h/left)
  KeyCode::Char('H') => {
      if let Some(col) = table_state.selected_column() {
          // Don't allow hiding if only one column visible
          if column_config.visible_count() > 1 {
              column_config.hide(col);
              widths = calculate_widths(&table_data, Some(&column_config));
              // If we hid the last visible column, select previous
              let visible = column_config.visible_indices();
              if let Some(&last_visible) = visible.last() {
                  if col > last_visible {
                      table_state.select_previous_column();
                  }
              }
          }
      }
  }

  // Show all hidden columns (S key)
  KeyCode::Char('S') => {
      column_config.show_all();
      widths = calculate_widths(&table_data, Some(&column_config));
  }
  ```

  Update title controls string:
  - TableData: "Esc: back, /: filter, :: query, +/-: resize, H: hide, S: show all, q: quit"
  - PipeData: "/: filter, +/-: resize, H: hide, S: show all, q: quit"

  Keep controls concise - "0: reset widths" can be removed from display (still works).
  </action>
  <verify>cargo run, hide column with H, show all with S, verify can't hide last column</verify>
  <done>H hides selected column, S shows all, can't hide last visible column</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build --release` succeeds without warnings
- [ ] `cargo test` passes all tests
- [ ] H key hides currently selected column
- [ ] S key shows all hidden columns
- [ ] Cannot hide the last visible column
- [ ] Title shows "(X hidden)" when columns are hidden
- [ ] Navigation h/l works correctly with hidden columns
- [ ] Reset (0) also shows hidden columns
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings
- Column hiding works intuitively with H/S keys
- Title indicates hidden column count
</success_criteria>

<output>
After completion, create `.planning/phases/07-column-controls/07-02-SUMMARY.md`
</output>
