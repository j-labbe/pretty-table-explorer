---
phase: 03-navigation
plan: 01
type: execute
depends_on: []
files_modified: [src/main.rs]
---

<objective>
Add keyboard navigation with vim-style (hjkl) and arrow key controls for row and column selection.

Purpose: Enable users to navigate through table data interactively, selecting rows and columns.
Output: Working navigation with visual selection highlighting.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-table-rendering/02-02-SUMMARY.md
@src/main.rs
@src/parser.rs

**Tech stack available:** ratatui 0.29, crossterm 0.28 with use-dev-tty
**Established patterns:** Event loop with 250ms poll, panic hook for terminal restore
**Key insight:** ratatui's TableState provides select_next(), select_previous(), select_first(), select_last() methods that handle bounds automatically. Use render_stateful_widget() instead of render_widget().
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TableState and row selection</name>
  <files>src/main.rs</files>
  <action>
1. Import TableState from ratatui::widgets
2. Create `let mut table_state = TableState::default().with_selected(Some(0));` before main loop (select first row by default)
3. Change `frame.render_widget(table, area)` to `frame.render_stateful_widget(table, area, &mut table_state)`
4. Add `.row_highlight_style(Style::default().add_modifier(Modifier::REVERSED))` to the Table builder to highlight selected row
5. Add `.highlight_symbol(">> ")` to show selection indicator

Note: TableState's select() methods use usize::MAX for "last" which ratatui auto-corrects during render. Don't manually clamp values.
  </action>
  <verify>cargo build succeeds, cargo test passes</verify>
  <done>Table renders with first row highlighted, selection state tracked</done>
</task>

<task type="auto">
  <name>Task 2: Handle navigation keys</name>
  <files>src/main.rs</files>
  <action>
Add key handlers in the event loop after the quit check:

```rust
// Vertical navigation
KeyCode::Char('j') | KeyCode::Down => table_state.select_next(),
KeyCode::Char('k') | KeyCode::Up => table_state.select_previous(),

// Jump to first/last
KeyCode::Char('g') | KeyCode::Home => table_state.select_first(),
KeyCode::Char('G') | KeyCode::End => table_state.select_last(),

// Horizontal column navigation
KeyCode::Char('h') | KeyCode::Left => table_state.select_previous_column(),
KeyCode::Char('l') | KeyCode::Right => table_state.select_next_column(),
```

Update the title to show navigation hints:
" Pretty Table Explorer - hjkl/arrows: navigate, q: quit "

Note: TableState methods handle bounds automatically - no need for manual row_count checks.
  </action>
  <verify>cargo build succeeds without warnings (except unused parser helpers)</verify>
  <done>j/k/Down/Up move selection, h/l/Left/Right move column, g/G/Home/End jump to first/last</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build` succeeds without errors
- [ ] `cargo test` passes all 8 parser tests
- [ ] Selection highlight visible on first row at start
- [ ] Navigation keys update selection (verified in code logic)
</verification>

<success_criteria>

- TableState tracks selection
- Row highlight visible
- All navigation keys mapped (j/k/h/l, arrows, g/G, Home/End)
- Title shows navigation hints
</success_criteria>

<output>
After completion, create `.planning/phases/03-navigation/03-01-SUMMARY.md`
</output>
